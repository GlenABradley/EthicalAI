============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-8.2.0, pluggy-1.6.0 -- C:\Users\glen4\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\glen4\Code\EthicalAI2\EthicalAI
configfile: pytest.ini
plugins: anyio-4.10.0, asyncio-1.1.0, cov-6.2.1
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 99 items

tests/api/test_frames_endpoints.py::test_frames_index_empty_ok 
------------------------------- live log setup --------------------------------
INFO     sentence_transformers.SentenceTransformer:SentenceTransformer.py:227 Load pretrained SentenceTransformer: all-MiniLM-L6-v2
PASSED                                                                   [  1%]
tests/api/test_frames_endpoints.py::test_frames_search_and_trace_empties PASSED [  2%]
tests/api/test_frames_index_contracts.py::test_index_wrong_coords_length_422 PASSED [  3%]
tests/api/test_frames_index_contracts.py::test_index_missing_pack_no_active_400 PASSED [  4%]
tests/api/test_frames_index_contracts.py::test_index_empty_frames_with_pack_returns_k_and_zero_ingested PASSED [  5%]
tests/api/test_frames_stats.py::test_frames_stats_ok PASSED              [  6%]
tests/api/test_payload_limits.py::test_analyze_payload_limit_413 PASSED  [  7%]
tests/memory/test_store_stubs.py::test_store_put_and_k_infer_and_stubs PASSED [  8%]
tests/test_advanced_axis_integration.py::test_advanced_axis_resonance PASSED [  9%]
tests/test_api.py::test_health_ready PASSED                              [ 10%]
tests/test_api_endpoints.py::test_resonance_with_vectors PASSED          [ 11%]
tests/test_api_endpoints.py::test_pipeline_analyze_with_vectors PASSED   [ 12%]
tests/test_api_endpoints.py::test_embed_endpoint_smoke PASSED            [ 13%]
tests/test_app_imports.py::test_app_importable PASSED                    [ 14%]
tests/test_axes_activate_thresholds.py::test_activate_reads_thresholds FAILED [ 15%]
tests/test_axes_orthonormal.py::test_gram_schmidt_orthonormal PASSED     [ 16%]
tests/test_axis_pack.py::test_axis_pack_builds_and_is_orthonormal PASSED [ 17%]
tests/test_axis_pack_384d.py::test_384d_axis_pack PASSED                 [ 18%]
tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_all_axis_packs_structure PASSED [ 19%]
tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_consequentialism_axis_pack FAILED [ 20%]
tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_deontology_axis_pack FAILED [ 21%]
tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_virtue_ethics_axis_pack FAILED [ 22%]
tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_cross_axis_ethical_analysis PASSED [ 23%]
tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_axis_pack_examples_quality PASSED [ 24%]
tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_ethical_evaluation_consistency PASSED [ 25%]
tests/test_axis_packs_comprehensive.py::TestEthicalEvaluationPipeline::test_full_pipeline_workflow PASSED [ 26%]
tests/test_axis_packs_comprehensive.py::TestEthicalEvaluationPipeline::test_vector_topology_ethical_mapping PASSED [ 27%]
tests/test_axis_packs_comprehensive.py::TestEthicalEvaluationPipeline::test_real_world_ethical_scenarios PASSED [ 28%]
tests/test_calibrate_cli.py::test_calibrate_cli_runs_and_writes_reports FAILED [ 29%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_health_check_comprehensive PASSED [ 30%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_text_embedding_functionality PASSED [ 31%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_axis_pack_loading PASSED [ 32%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_ethical_evaluation_pipeline PASSED [ 33%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_batch_ethical_analysis PASSED [ 34%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_complex_ethical_scenarios PASSED [ 35%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_what_if_analysis PASSED [ 36%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_vector_topology_analysis PASSED [ 37%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_performance_large_inputs PASSED [ 38%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_error_handling PASSED [ 39%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_axis_configuration PASSED [ 40%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_resonance_analysis PASSED [ 41%]
tests/test_comprehensive_e2e.py::TestComprehensiveEthicalAI::test_pipeline_integration PASSED [ 42%]
tests/test_comprehensive_e2e.py::TestEthicalAIIntegration::test_end_to_end_ethical_workflow PASSED [ 43%]
tests/test_comprehensive_e2e.py::TestEthicalAIIntegration::test_cross_axis_consistency PASSED [ 44%]
tests/test_constitution_rank.py::test_rank_prefers_no_veto_then_composite_then_logprob FAILED [ 45%]
tests/test_constitution_rank.py::test_axis_composite_meaningful PASSED   [ 46%]
tests/test_diffusion.py::test_energy_decreases_with_tau PASSED           [ 47%]
tests/test_end_to_end.py::test_health_check PASSED                       [ 48%]
tests/test_end_to_end.py::test_embed_endpoint PASSED                     [ 49%]
tests/test_end_to_end.py::test_analyze_endpoint PASSED                   [ 50%]
tests/test_end_to_end.py::test_batch_analysis PASSED                     [ 51%]
tests/test_end_to_end.py::test_whatif_analysis PASSED                    [ 52%]
tests/test_eval_api.py::test_eval_text_flow PASSED                       [ 53%]
tests/test_eval_spans.py::test_project_scores_shapes PASSED              [ 54%]
tests/test_frames_logic.py::test_srl_lite_and_vectorize_deterministic PASSED [ 55%]
tests/test_frames_logic.py::test_three_valued_logic_tables PASSED        [ 56%]
tests/test_frontend_integration.py::TestFrontendBackendIntegration::test_api_endpoints_for_frontend PASSED [ 57%]
tests/test_frontend_integration.py::TestFrontendBackendIntegration::test_cors_configuration PASSED [ 58%]
tests/test_frontend_integration.py::TestFrontendBackendIntegration::test_api_response_format PASSED [ 59%]
tests/test_frontend_integration.py::TestFrontendBackendIntegration::test_error_response_format PASSED [ 60%]
tests/test_frontend_integration.py::TestFrontendBackendIntegration::test_batch_processing_for_ui PASSED [ 61%]
tests/test_frontend_integration.py::TestFrontendBackendIntegration::test_real_time_analysis_simulation PASSED [ 62%]
tests/test_frontend_integration.py::TestUIComponentDataFlow::test_interaction_page_workflow PASSED [ 63%]
tests/test_frontend_integration.py::TestUIComponentDataFlow::test_visualization_data_format PASSED [ 64%]
tests/test_frontend_integration.py::TestUIComponentDataFlow::test_ethical_axis_data_structure PASSED [ 65%]
tests/test_frontend_integration.py::TestUIComponentDataFlow::test_performance_for_interactive_ui PASSED [ 66%]
tests/test_frontend_integration.py::TestAPIContractCompliance::test_embedding_api_contract PASSED [ 67%]
tests/test_frontend_integration.py::TestAPIContractCompliance::test_health_api_contract PASSED [ 68%]
tests/test_frontend_integration.py::TestAPIContractCompliance::test_error_handling_contract PASSED [ 69%]
tests/test_health_ready.py::test_health_ready_fast PASSED                [ 70%]
tests/test_interaction_api.py::test_interaction_allow_path FAILED        [ 71%]
tests/test_interaction_refusal.py::test_interaction_refusal_and_alternatives FAILED [ 72%]
tests/test_minimal.py::test_minimal PASSED                               [ 73%]
tests/test_openapi_generates.py::test_openapi_generation PASSED          [ 74%]
tests/test_performance.py::test_embed_endpoint_performance PASSED        [ 75%]
tests/test_performance.py::test_analyze_endpoint_performance PASSED      [ 76%]
tests/test_performance.py::test_concurrent_requests FAILED               [ 77%]
tests/test_performance_benchmarks.py::TestPerformanceBenchmarks::test_single_embedding_performance PASSED [ 78%]
tests/test_performance_benchmarks.py::TestPerformanceBenchmarks::test_batch_embedding_performance PASSED [ 79%]
tests/test_performance_benchmarks.py::TestPerformanceBenchmarks::test_concurrent_request_handling PASSED [ 80%]
tests/test_performance_benchmarks.py::TestPerformanceBenchmarks::test_large_text_performance PASSED [ 81%]
tests/test_performance_benchmarks.py::TestPerformanceBenchmarks::test_memory_usage_stability PASSED [ 82%]
tests/test_performance_benchmarks.py::TestPerformanceBenchmarks::test_error_recovery_performance FAILED [ 83%]

================================== FAILURES ===================================
_______________________ test_activate_reads_thresholds ________________________
tests\test_axes_activate_thresholds.py:16: in test_activate_reads_thresholds
    assert r.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
2025-08-31 17:18:31,672 INFO coherence.api - create_app: start
2025-08-31 17:18:31,689 INFO coherence.api - App created with config: {'server': {'host': '0.0.0.0', 'port': 8080, 'reload': True}, 'api': {'max_doc_chars': 100000}}
2025-08-31 17:18:31,689 INFO coherence.api - create_app: done in 0.016s
---------------------------- Captured stdout call -----------------------------
2025-08-31 17:18:31,690 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:31,697 INFO httpx - HTTP Request: POST http://testserver/v1/axes/thresh-pack/activate "HTTP/1.1 404 Not Found"
------------------------------ Captured log call ------------------------------
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/v1/axes/thresh-pack/activate "HTTP/1.1 404 Not Found"
_________ TestAxisPacksComprehensive.test_consequentialism_axis_pack __________
tests\test_axis_packs_comprehensive.py:64: in test_consequentialism_axis_pack
    assert response.status_code in [200, 201, 409]  # Success or already exists
E   assert 404 in [200, 201, 409]
E    +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
2025-08-31 17:18:31,747 INFO coherence.api - create_app: start
2025-08-31 17:18:31,761 INFO coherence.api - App created with config: {'server': {'host': '0.0.0.0', 'port': 8080, 'reload': True}, 'api': {'max_doc_chars': 100000}}
2025-08-31 17:18:31,761 INFO coherence.api - create_app: done in 0.016s
---------------------------- Captured stdout call -----------------------------
2025-08-31 17:18:31,772 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:31,772 INFO httpx - HTTP Request: POST http://testserver/v1/axes "HTTP/1.1 404 Not Found"
------------------------------ Captured log call ------------------------------
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/v1/axes "HTTP/1.1 404 Not Found"
____________ TestAxisPacksComprehensive.test_deontology_axis_pack _____________
tests\test_axis_packs_comprehensive.py:87: in test_deontology_axis_pack
    assert response.status_code in [200, 201, 409]
E   assert 404 in [200, 201, 409]
E    +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
2025-08-31 17:18:31,787 INFO coherence.api - create_app: start
2025-08-31 17:18:31,797 INFO coherence.api - App created with config: {'server': {'host': '0.0.0.0', 'port': 8080, 'reload': True}, 'api': {'max_doc_chars': 100000}}
2025-08-31 17:18:31,797 INFO coherence.api - create_app: done in 0.017s
---------------------------- Captured stdout call -----------------------------
2025-08-31 17:18:31,797 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:31,797 INFO httpx - HTTP Request: POST http://testserver/v1/axes "HTTP/1.1 404 Not Found"
------------------------------ Captured log call ------------------------------
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/v1/axes "HTTP/1.1 404 Not Found"
___________ TestAxisPacksComprehensive.test_virtue_ethics_axis_pack ___________
tests\test_axis_packs_comprehensive.py:109: in test_virtue_ethics_axis_pack
    assert response.status_code in [200, 201, 409]
E   assert 404 in [200, 201, 409]
E    +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
2025-08-31 17:18:31,813 INFO coherence.api - create_app: start
2025-08-31 17:18:31,833 INFO coherence.api - App created with config: {'server': {'host': '0.0.0.0', 'port': 8080, 'reload': True}, 'api': {'max_doc_chars': 100000}}
2025-08-31 17:18:31,833 INFO coherence.api - create_app: done in 0.016s
---------------------------- Captured stdout call -----------------------------
2025-08-31 17:18:31,833 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:31,833 INFO httpx - HTTP Request: POST http://testserver/v1/axes "HTTP/1.1 404 Not Found"
------------------------------ Captured log call ------------------------------
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/v1/axes "HTTP/1.1 404 Not Found"
_________________ test_calibrate_cli_runs_and_writes_reports __________________
tests\test_calibrate_cli.py:28: in test_calibrate_cli_runs_and_writes_reports
    assert res.returncode == 0, res.stderr
E   AssertionError: Traceback (most recent call last):
E       File "<frozen runpy>", line 198, in _run_module_as_main
E       File "<frozen runpy>", line 88, in _run_code
E       File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\axes\calibrate.py", line 158, in <module>
E         main()
E       File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\axes\calibrate.py", line 130, in main
E         scores = _collect_scores(args.dataset, pack, enc)
E                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\axes\calibrate.py", line 84, in _collect_scores
E         s = _score_text_per_axis(text, pack, encoder)
E             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\axes\calibrate.py", line 74, in _score_text_per_axis
E         out[ax.name] = float(v @ ax.vector)
E                              ~~^~~~~~~~~~~
E     ValueError: matmul: Input operand 1 has a mismatch in its core dimension 0, with gufunc signature (n?,k),(k,m?)->(n?,m?) (size 16 is different from 384)
E     
E   assert 1 == 0
E    +  where 1 = CompletedProcess(args=['C:\\Users\\glen4\\AppData\\Local\\Programs\\Python\\Python312\\python.exe', '-m', 'ethicalai.axes.calibrate', '--pack', 'cli-test-pack', '--dataset', 'data/calibration/autonomy.jsonl', '--dataset', 'data/calibration/truth.jsonl', '--reports', 'C:\\Users\\glen4\\AppData\\Local\\Temp\\pytest-of-glen4\\pytest-13\\test_calibrate_cli_runs_and_wr0\\reports'], returncode=1, stdout='', stderr='Traceback (most recent call last):\n  File "<frozen runpy>", line 198, in _run_module_as_main\n  File "<frozen runpy>", line 88, in _run_code\n  File "C:\\Users\\glen4\\Code\\EthicalAI2\\EthicalAI\\src\\ethicalai\\axes\\calibrate.py", line 158, in <module>\n    main()\n  File "C:\\Users\\glen4\\Code\\EthicalAI2\\EthicalAI\\src\\ethicalai\\axes\\calibrate.py", line 130, in main\n    scores = _collect_scores(args.dataset, pack, enc)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "C:\\Users\\glen4\\Code\\EthicalAI2\\EthicalAI\\src\\ethicalai\\axes\\calibrate.py", line 84, in _collect_scores\n    s = _score_text_per_axis(text, pack, encoder)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "C:\\Users\\glen4\\Code\\EthicalAI2\\EthicalAI\\src\\ethicalai\\axes\\calibrate.py", line 74, in _score_text_per_axis\n    out[ax.name] = float(v @ ax.vector)\n                         ~~^~~~~~~~~~~\nValueError: matmul: Input operand 1 has a mismatch in its core dimension 0, with gufunc signature (n?,k),(k,m?)->(n?,m?) (size 16 is different from 384)\n').returncode
____________ test_rank_prefers_no_veto_then_composite_then_logprob ____________
tests\test_constitution_rank.py:47: in test_rank_prefers_no_veto_then_composite_then_logprob
    assert result["choice"]["text"] in ("A T","AT","A T ")
E   AssertionError: assert 'A' in ('A T', 'AT', 'A T ')
_________________________ test_interaction_allow_path _________________________
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_utils.py", line 77, in collapse_excgroups
  |     yield
  |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 183, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\runner.py", line 341, in from_call
    |     result: Optional[TResult] = func()
    |                                 ^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\runner.py", line 241, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\threadexception.py", line 87, in pytest_runtest_call
    |     yield from thread_exception_runtest_hook()
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\threadexception.py", line 63, in thread_exception_runtest_hook
    |     yield
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\unraisableexception.py", line 90, in pytest_runtest_call
    |     yield from unraisable_exception_runtest_hook()
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\unraisableexception.py", line 65, in unraisable_exception_runtest_hook
    |     yield
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\logging.py", line 850, in pytest_runtest_call
    |     yield from self._runtest_for(item, "call")
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\logging.py", line 833, in _runtest_for
    |     yield
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\capture.py", line 878, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\skipping.py", line 257, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\runner.py", line 183, in pytest_runtest_call
    |     raise e
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\runner.py", line 173, in pytest_runtest_call
    |     item.runtest()
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\python.py", line 1627, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\python.py", line 162, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\tests\test_interaction_api.py", line 15, in test_interaction_allow_path
    |     r = api_client.post("/v1/interaction/respond", json={"prompt":"hello world"})
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py", line 552, in post
    |     return super().post(
    |            ^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 1144, in post
    |     return self.request(
    |            ^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py", line 451, in request
    |     return super().request(
    |            ^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 825, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 914, in send
    |     response = self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    |     response = transport.handle_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py", line 354, in handle_request
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py", line 351, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\from_thread.py", line 291, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\_base.py", line 456, in result
    |     return self.__get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\from_thread.py", line 222, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_utils.py", line 83, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\coherence\api\main.py", line 45, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    |     raise app_exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 78, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 75, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 302, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 215, in run_endpoint_function
    |     return await run_in_threadpool(dependant.call, **values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 2476, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 967, in run
    |     result = context.run(func, *args)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\api\interaction.py", line 40, in respond
    |     result = rank_candidates(cands, pack)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\constitution\decoding.py", line 50, in rank_candidates
    |     key, proof = _score_candidate(text, logp, pack, enc=enc, pref_axes=pref_axes)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\constitution\decoding.py", line 24, in _score_candidate
    |     raise ValueError(f"Encoder dim {X.shape[1]} != pack dim {pack.dim}")
    | ValueError: Encoder dim 384 != pack dim 16
    +------------------------------------

During handling of the above exception, another exception occurred:
tests\test_interaction_api.py:15: in test_interaction_allow_path
    r = api_client.post("/v1/interaction/respond", json={"prompt":"hello world"})
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py:552: in post
    return super().post(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:1144: in post
    return self.request(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py:451: in request
    return super().request(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py:354: in handle_request
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\from_thread.py:291: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
..\..\..\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\from_thread.py:222: in _call_func
    retval = await retval_or_awaitable
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py:186: in __call__
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py:164: in __call__
    await self.app(scope, receive, _send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py:85: in __call__
    await self.app(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py:182: in __call__
    with recv_stream, send_stream, collapse_excgroups():
..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:158: in __exit__
    self.gen.throw(value)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_utils.py:83: in collapse_excgroups
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py:184: in __call__
    response = await self.dispatch_func(request, call_next)
src\coherence\api\main.py:45: in dispatch
    response = await call_next(request)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py:159: in call_next
    raise app_exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:736: in app
    await route.handle(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:290: in handle
    await self.app(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:78: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:75: in app
    response = await f(request)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py:302: in app
    raw_response = await run_endpoint_function(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py:215: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py:2476: in run_sync_in_worker_thread
    return await future
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py:967: in run
    result = context.run(func, *args)
src\ethicalai\api\interaction.py:40: in respond
    result = rank_candidates(cands, pack)
src\ethicalai\constitution\decoding.py:50: in rank_candidates
    key, proof = _score_candidate(text, logp, pack, enc=enc, pref_axes=pref_axes)
src\ethicalai\constitution\decoding.py:24: in _score_candidate
    raise ValueError(f"Encoder dim {X.shape[1]} != pack dim {pack.dim}")
E   ValueError: Encoder dim 384 != pack dim 16
---------------------------- Captured stdout setup ----------------------------
2025-08-31 17:18:36,721 INFO coherence.api - create_app: start
2025-08-31 17:18:36,746 INFO coherence.api - App created with config: {'server': {'host': '0.0.0.0', 'port': 8080, 'reload': True}, 'api': {'max_doc_chars': 100000}}
2025-08-31 17:18:36,746 INFO coherence.api - create_app: done in 0.017s
---------------------------- Captured stdout call -----------------------------
2025-08-31 17:18:36,747 DEBUG asyncio - Using proactor: IocpProactor
------------------------------ Captured log call ------------------------------
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
__________________ test_interaction_refusal_and_alternatives __________________
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_utils.py", line 77, in collapse_excgroups
  |     yield
  |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 183, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\runner.py", line 341, in from_call
    |     result: Optional[TResult] = func()
    |                                 ^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\runner.py", line 241, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\threadexception.py", line 87, in pytest_runtest_call
    |     yield from thread_exception_runtest_hook()
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\threadexception.py", line 63, in thread_exception_runtest_hook
    |     yield
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\unraisableexception.py", line 90, in pytest_runtest_call
    |     yield from unraisable_exception_runtest_hook()
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\unraisableexception.py", line 65, in unraisable_exception_runtest_hook
    |     yield
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\logging.py", line 850, in pytest_runtest_call
    |     yield from self._runtest_for(item, "call")
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\logging.py", line 833, in _runtest_for
    |     yield
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\capture.py", line 878, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\skipping.py", line 257, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\runner.py", line 183, in pytest_runtest_call
    |     raise e
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\runner.py", line 173, in pytest_runtest_call
    |     item.runtest()
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\python.py", line 1627, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\python.py", line 162, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\tests\test_interaction_refusal.py", line 15, in test_interaction_refusal_and_alternatives
    |     r = api_client.post("/v1/interaction/respond", json={"prompt":"edge case"})
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py", line 552, in post
    |     return super().post(
    |            ^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 1144, in post
    |     return self.request(
    |            ^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py", line 451, in request
    |     return super().request(
    |            ^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 825, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 914, in send
    |     response = self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    |     response = transport.handle_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py", line 354, in handle_request
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py", line 351, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\from_thread.py", line 291, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\_base.py", line 456, in result
    |     return self.__get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\from_thread.py", line 222, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_utils.py", line 83, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\coherence\api\main.py", line 45, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    |     raise app_exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 78, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 75, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 302, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 215, in run_endpoint_function
    |     return await run_in_threadpool(dependant.call, **values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 2476, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 967, in run
    |     result = context.run(func, *args)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\api\interaction.py", line 40, in respond
    |     result = rank_candidates(cands, pack)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\constitution\decoding.py", line 50, in rank_candidates
    |     key, proof = _score_candidate(text, logp, pack, enc=enc, pref_axes=pref_axes)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\constitution\decoding.py", line 24, in _score_candidate
    |     raise ValueError(f"Encoder dim {X.shape[1]} != pack dim {pack.dim}")
    | ValueError: Encoder dim 384 != pack dim 16
    +------------------------------------

During handling of the above exception, another exception occurred:
tests\test_interaction_refusal.py:15: in test_interaction_refusal_and_alternatives
    r = api_client.post("/v1/interaction/respond", json={"prompt":"edge case"})
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py:552: in post
    return super().post(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:1144: in post
    return self.request(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py:451: in request
    return super().request(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py:354: in handle_request
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\from_thread.py:291: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
..\..\..\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\from_thread.py:222: in _call_func
    retval = await retval_or_awaitable
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py:186: in __call__
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\errors.py:164: in __call__
    await self.app(scope, receive, _send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py:85: in __call__
    await self.app(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py:182: in __call__
    with recv_stream, send_stream, collapse_excgroups():
..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:158: in __exit__
    self.gen.throw(value)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_utils.py:83: in collapse_excgroups
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py:184: in __call__
    response = await self.dispatch_func(request, call_next)
src\coherence\api\main.py:45: in dispatch
    response = await call_next(request)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py:159: in call_next
    raise app_exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:736: in app
    await route.handle(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:290: in handle
    await self.app(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:78: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py:75: in app
    response = await f(request)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py:302: in app
    raw_response = await run_endpoint_function(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py:215: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py:2476: in run_sync_in_worker_thread
    return await future
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py:967: in run
    result = context.run(func, *args)
src\ethicalai\api\interaction.py:40: in respond
    result = rank_candidates(cands, pack)
src\ethicalai\constitution\decoding.py:50: in rank_candidates
    key, proof = _score_candidate(text, logp, pack, enc=enc, pref_axes=pref_axes)
src\ethicalai\constitution\decoding.py:24: in _score_candidate
    raise ValueError(f"Encoder dim {X.shape[1]} != pack dim {pack.dim}")
E   ValueError: Encoder dim 384 != pack dim 16
---------------------------- Captured stdout setup ----------------------------
2025-08-31 17:18:37,200 INFO coherence.api - create_app: start
2025-08-31 17:18:37,211 INFO coherence.api - App created with config: {'server': {'host': '0.0.0.0', 'port': 8080, 'reload': True}, 'api': {'max_doc_chars': 100000}}
2025-08-31 17:18:37,211 INFO coherence.api - create_app: done in 0.016s
---------------------------- Captured stdout call -----------------------------
2025-08-31 17:18:37,211 DEBUG asyncio - Using proactor: IocpProactor
------------------------------ Captured log call ------------------------------
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
__________________________ test_concurrent_requests ___________________________
tests\test_performance.py:224: in test_concurrent_requests
    assert success_rate >= 0.95, "Success rate below 95% for concurrent requests"
E   AssertionError: Success rate below 95% for concurrent requests
E   assert 0.0 >= 0.95
---------------------------- Captured stdout setup ----------------------------
2025-08-31 17:18:44,310 INFO coherence.api - create_app: start
2025-08-31 17:18:44,334 INFO coherence.api - App created with config: {'server': {'host': '0.0.0.0', 'port': 8080, 'reload': True}, 'api': {'max_doc_chars': 100000}}
2025-08-31 17:18:44,334 INFO coherence.api - create_app: done in 0.024s
---------------------------- Captured stdout call -----------------------------
2025-08-31 17:18:44,336 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,337 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,338 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,338 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,339 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,340 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,341 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,342 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,343 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,344 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,354 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,356 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,357 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,359 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,360 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,362 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,362 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,363 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,366 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,367 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,369 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,370 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,370 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,370 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,372 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,372 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,373 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,375 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,376 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,378 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,380 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,382 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,382 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,383 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,384 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,385 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,387 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,388 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,388 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,393 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,393 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,394 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,398 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,400 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,401 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,402 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,403 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,404 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,404 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,404 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,405 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,407 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,408 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,409 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,410 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,413 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,415 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,416 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,418 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,418 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,419 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,420 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,423 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,425 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,426 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,427 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,428 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,429 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,430 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,435 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,437 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,437 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,437 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,439 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,439 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,440 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,440 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,441 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,442 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,443 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,444 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,444 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,447 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,449 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,450 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,450 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,453 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,454 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,454 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,460 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,462 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,462 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,463 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,465 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,465 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,466 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,466 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,466 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,467 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,469 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,470 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,472 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,473 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,473 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,474 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,476 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,477 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,477 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,478 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,478 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,479 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,479 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,480 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,480 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,480 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,483 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,484 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,484 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,486 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,487 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,488 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,488 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,489 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,490 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,491 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,492 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,492 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,493 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,493 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,494 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,494 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,495 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,497 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,499 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,499 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,500 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,500 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,502 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,502 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,503 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,504 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,505 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,505 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,506 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,507 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,508 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,508 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,509 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,509 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,510 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,511 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,513 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,513 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,513 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,514 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,514 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,516 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,517 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,520 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,520 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,522 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,523 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,523 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,523 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,524 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,525 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,525 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,526 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,526 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,527 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,529 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,530 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,531 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,531 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,532 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,532 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,532 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,533 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,533 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,535 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,537 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,538 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,539 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,540 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,540 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,542 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,543 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,544 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,544 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,546 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,546 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,547 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:44,547 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,549 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,549 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,550 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,550 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,553 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,554 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
2025-08-31 17:18:44,554 INFO httpx - HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"

Concurrent Requests Test (100 requests, 10 concurrent):
Success rate: 0.00%
------------------------------ Captured log call ------------------------------
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/health "HTTP/1.1 404 Not Found"
__________ TestPerformanceBenchmarks.test_error_recovery_performance __________
tests\test_performance_benchmarks.py:250: in test_error_recovery_performance
    assert response.status_code in [400, 422]
E   assert 200 in [400, 422]
E    +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stdout setup ----------------------------
2025-08-31 17:18:49,044 INFO coherence.api - create_app: start
2025-08-31 17:18:49,062 INFO coherence.api - App created with config: {'server': {'host': '0.0.0.0', 'port': 8080, 'reload': True}, 'api': {'max_doc_chars': 100000}}
2025-08-31 17:18:49,062 INFO coherence.api - create_app: done in 0.022s
---------------------------- Captured stdout call -----------------------------
2025-08-31 17:18:49,062 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:49,062 INFO httpx - HTTP Request: POST http://testserver/embed "HTTP/1.1 422 Unprocessable Entity"
2025-08-31 17:18:49,071 DEBUG asyncio - Using proactor: IocpProactor
2025-08-31 17:18:49,093 INFO httpx - HTTP Request: POST http://testserver/embed "HTTP/1.1 200 OK"
------------------------------ Captured log call ------------------------------
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/embed "HTTP/1.1 422 Unprocessable Entity"
DEBUG    asyncio:proactor_events.py:634 Using proactor: IocpProactor
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/embed "HTTP/1.1 200 OK"
============================== warnings summary ===============================
tests/test_end_to_end.py::test_embed_endpoint
tests/test_end_to_end.py::test_analyze_endpoint
tests/test_end_to_end.py::test_batch_analysis
tests/test_end_to_end.py::test_batch_analysis
tests/test_end_to_end.py::test_batch_analysis
tests/test_end_to_end.py::test_batch_analysis
tests/test_end_to_end.py::test_batch_analysis
tests/test_end_to_end.py::test_whatif_analysis
  C:\Users\glen4\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\testclient.py:445: DeprecationWarning: You should not use the 'timeout' argument with the TestClient. See https://github.com/encode/starlette/issues/1108 for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_axes_activate_thresholds.py::test_activate_reads_thresholds - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_consequentialism_axis_pack - assert 404 in [200, 201, 409]
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_deontology_axis_pack - assert 404 in [200, 201, 409]
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/test_axis_packs_comprehensive.py::TestAxisPacksComprehensive::test_virtue_ethics_axis_pack - assert 404 in [200, 201, 409]
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/test_calibrate_cli.py::test_calibrate_cli_runs_and_writes_reports - AssertionError: Traceback (most recent call last):
    File "<frozen runpy>", line 198, in _run_module_as_main
    File "<frozen runpy>", line 88, in _run_code
    File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\axes\calibrate.py", line 158, in <module>
      main()
    File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\axes\calibrate.py", line 130, in main
      scores = _collect_scores(args.dataset, pack, enc)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\axes\calibrate.py", line 84, in _collect_scores
      s = _score_text_per_axis(text, pack, encoder)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\glen4\Code\EthicalAI2\EthicalAI\src\ethicalai\axes\calibrate.py", line 74, in _score_text_per_axis
      out[ax.name] = float(v @ ax.vector)
                           ~~^~~~~~~~~~~
  ValueError: matmul: Input operand 1 has a mismatch in its core dimension 0, with gufunc signature (n?,k),(k,m?)->(n?,m?) (size 16 is different from 384)
  
assert 1 == 0
 +  where 1 = CompletedProcess(args=['C:\\Users\\glen4\\AppData\\Local\\Programs\\Python\\Python312\\python.exe', '-m', 'ethicalai.axes.calibrate', '--pack', 'cli-test-pack', '--dataset', 'data/calibration/autonomy.jsonl', '--dataset', 'data/calibration/truth.jsonl', '--reports', 'C:\\Users\\glen4\\AppData\\Local\\Temp\\pytest-of-glen4\\pytest-13\\test_calibrate_cli_runs_and_wr0\\reports'], returncode=1, stdout='', stderr='Traceback (most recent call last):\n  File "<frozen runpy>", line 198, in _run_module_as_main\n  File "<frozen runpy>", line 88, in _run_code\n  File "C:\\Users\\glen4\\Code\\EthicalAI2\\EthicalAI\\src\\ethicalai\\axes\\calibrate.py", line 158, in <module>\n    main()\n  File "C:\\Users\\glen4\\Code\\EthicalAI2\\EthicalAI\\src\\ethicalai\\axes\\calibrate.py", line 130, in main\n    scores = _collect_scores(args.dataset, pack, enc)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "C:\\Users\\glen4\\Code\\EthicalAI2\\EthicalAI\\src\\ethicalai\\axes\\calibrate.py", line 84, in _collect_scores\n    s = _score_text_per_axis(text, pack, encoder)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File "C:\\Users\\glen4\\Code\\EthicalAI2\\EthicalAI\\src\\ethicalai\\axes\\calibrate.py", line 74, in _score_text_per_axis\n    out[ax.name] = float(v @ ax.vector)\n                         ~~^~~~~~~~~~~\nValueError: matmul: Input operand 1 has a mismatch in its core dimension 0, with gufunc signature (n?,k),(k,m?)->(n?,m?) (size 16 is different from 384)\n').returncode
FAILED tests/test_constitution_rank.py::test_rank_prefers_no_veto_then_composite_then_logprob - AssertionError: assert 'A' in ('A T', 'AT', 'A T ')
FAILED tests/test_interaction_api.py::test_interaction_allow_path - ValueError: Encoder dim 384 != pack dim 16
FAILED tests/test_interaction_refusal.py::test_interaction_refusal_and_alternatives - ValueError: Encoder dim 384 != pack dim 16
FAILED tests/test_performance.py::test_concurrent_requests - AssertionError: Success rate below 95% for concurrent requests
assert 0.0 >= 0.95
FAILED tests/test_performance_benchmarks.py::TestPerformanceBenchmarks::test_error_recovery_performance - assert 200 in [400, 422]
 +  where 200 = <Response [200 OK]>.status_code
!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 10 failures !!!!!!!!!!!!!!!!!!!!!!!!!!
============ 10 failed, 73 passed, 8 warnings in 107.72s (0:01:47) ============
